FROM python:3.11-slim

WORKDIR /code

# System deps for psycopg2
RUN apt-get update && apt-get install -y gcc libpq-dev

# Copy common package first
COPY ../helpcenter-common /code/helpcenter-common

# Copy requirements and install
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Set Python path to include common package
ENV PYTHONPATH=/code:/code/helpcenter-common

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]